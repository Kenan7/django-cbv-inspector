{% extends "base.html" %}
{# {% load pygmy %} #}
{# {% load cbv_tags %} #}
{# {% load url from future %} #}
{# {% load i18n %} #}


{% block title %}{{ klass.name }}{% endblock %}


{% block extra_js %}
    <script>
        // Activate accordion
        $(function () {
            $(".collapse").collapse();
            // Method collapsing/expanding buttons
            $("#collapse-methods-btn").click(function() {
                CCBV.method_list.collapse();
            });
            $("#expand-methods-btn").click(function() {
                CCBV.method_list.expand();
            });
        })
    </script>
    {# <script src="{{ STATIC_URL }}ccbv.js"></script> #}
{% endblock %}


{% block nav %}
    {# {% nav object.module.project_version object.module object %} #}
{% endblock nav %}


{% block page_header %}
    <h1><small>class</small>&nbsp;{{ klass.name }}</h1>
    <pre>from {{ klass.import_path }} import {{ klass.name }}</pre>
    <div class="pull-right">
        {# {% with url=object.basic_yuml_url %} #}
        {#     {% if url %} #}
        {#         <a class="btn btn-small btn-info" href="{{ url }}">Hierarchy diagram</a> #}
        {#     {% else %} #}
        {#         <span class="btn btn-small btn-info disabled">Hierarchy diagram</span> #}
        {#     {% endif %} #}
        {# {% endwith %} #}
        {% if klass.docs_url %}
        <a class="btn btn-small btn-info" href="{{ klass.docs_url }}">Documentation</a>
        {% else %}
        <span class="btn btn-small btn-info disabled">Documentation</span>
        {% endif %}
        <a class="btn btn-small btn-info" href="{{ klass.source_url }}">Source code</a>
    </div>
    {% if klass.docstring %}
        <pre class="docstring">{{ klass.docstring }}</pre>
    {% endif %}
{% endblock %}


{% block content %}
    <div class="span12">
        <div class="row">
            {% for ancestor in klass.ancestors %}
                {% if loop.first %}
                    <div class="span4">
                    <h2>Ancestors (<abbr title="Method Resolution Order">MRO</abbr>)</h2>
                    <ol start='0' id="ancestors">
                    <li><strong>{{ klass.name }}</strong></li>
                {% endif %}
                <li>
                    <a href="{{ ancestor.get_absolute_url }}" class="{% if ancestor in direct_ancestors %}direct{% endif %}">
                        {{ ancestor.name }}
                    </a>
                </li>
                {% if loop.last %}</ol></div>{% endif %}
            {% endfor %}

            {# {% for child in object.get_all_children %} #}
            {#     {% if loop.first %} #}
            {#     <div id="descendants" class="span{% if direct_ancestors %}8{% else %}12{% endif %}"> #}
            {#     <h2>Descendants</h2> #}
            {#     <ul class="unstyled"> #}
            {#     {% endif %} #}
            {#         <li><a href="{{ child.get_absolute_url }}">{{ child }}</a></li> #}
            {#     {% if loop.last %}</ul></div>{% endif %} #}
            {# {% endfor %} #}
        </div>

        <div class="row">
            <div class="span12">
                <h2>Attributes</h2>
                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                        <tr>
                            <th>&nbsp;</th>
                            <th>Defined in</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for attribute in klass.attributes %}
                        <tr>
                            <td>
                                <code class="attribute{%if attribute.overridden %} overridden{% endif %}">
                                    {{ attribute }} = {{ attribute }}
                                </code>
                            </td>
                            <td>
                                {# {% if attribute.klass == klass %} #}
                                    {{ attribute.klass }}
                                {# {% else %} #}
                                {#     <a href="{{ attribute.klass.get_absolute_url }}">{{ attribute.klass }}</a> #}
                                {# {% endif %} #}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                </div>
        </div>
        <div class="row">
            <div id="method-list" class="span12 accordion">
                <div id='method-buttons'>
                    <span class="btn btn-small" id="expand-methods-btn">Expand</span>
                    <span class="btn btn-small" id="collapse-methods-btn">Collapse</span>
                </div>
                <h2>Methods</h2>
                {% for method in klass.methods %}
                {# {% ifchanged method.name %} #}
                    {# {% with namesakes=klass|namesake_methods:method.name %} #}
                    <div class="method accordion-group">
                        <header class="accordion-heading btn" data-toggle="collapse" data-target="#{{ method }}">
                            <h3>
                                <code class="signature highlight">
                                    <span class="k">def</span>
                                    <span class="nf">{{ method }}</span>(<span class="n">{{ method.arguments }}</span>):
                                </code>
                                {% if namesakes|length == 1 %}
                                    <small class="pull-right">{{ method.defining_class }}</small>
                                {% endif %}
                            </h3>
                        </header>
                        <div id="{{ method.name }}" class="accordion-body collapse in">
                            {% for namesake in method %}
                                {% if namesakes|length != 1 %}
                                    <div class="namesake accordion-group">
                                        <header class="accordion-heading" data-toggle="collapse" data-target="#{{ namesake.name }}-{{ namesake.klass }}">
                                            <h4 class="accordion-toggle">{{ namesake.klass }}</h4>
                                        </header>
                                        <div id="{{ namesake.name }}-{{ namesake.klass }}" class="accordion-body collapse in">
                                            <div class="accordion-inner">
                                {% endif %}
                                                {% if namesake.docstring %}<pre class="docstring">{{ namesake.docstring }}</pre>{% endif %}
                                                {# {% pygmy namesake.code linenos='True' linenostart=namesake.line_number lexer='python' %} #}
                                {% if namesakes|length != 1 %}
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {# {% endwith %} #}
                {# {% endifchanged %} #}
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
